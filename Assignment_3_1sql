--DROP USER ASSIGNMENT3 CASCADE;

CREATE USER ASSIGNMENT3 IDENTIFIED BY ASSIGNMENT3;

CREATE TABLE ASSIGNMENT3.DEPARTMENT (
  DEPT_ID INT NOT NULL,
  DEPT_NAME   VARCHAR(50) NOT NULL,
  CONSTRAINT PK_DEPARTMENT PRIMARY KEY (DEPT_ID)
);

CREATE TABLE ASSIGNMENT3.GRADE (
    GRADE_CD CHAR(1) NOT NULL,
    CONSTRAINT PK_GRADE PRIMARY KEY (GRADE_CD),
    CONSTRAINT CHK_GRADE_CD CHECK (GRADE_CD IN ('A', 'B', 'C'))
);

CREATE TABLE ASSIGNMENT3.EMPLOYEE (
  EMP_ID INT NOT NULL,
  DEPT_ID INT NOT NULL,
  GRADE_CD CHAR(1) NOT NULL,
  EMP_NAME VARCHAR(100) NOT NULL,
  EMP_ADDRESS_LINE_1 VARCHAR(100) NOT NULL,
  EMP_ADDRESS_LINE_2 VARCHAR(100) NULL,
  EMP_CITY VARCHAR(50) NULL,
  BASIC_SAL INT NOT NULL,
  DATE_OF_JOIN DATE DEFAULT SYSDATE,
  CONSTRAINT PK_EMPLOYEE PRIMARY KEY (EMP_ID),
  CONSTRAINT FK_EMP_DEPT FOREIGN KEY (DEPT_ID) REFERENCES ASSIGNMENT3.DEPARTMENT(DEPT_ID),
  CONSTRAINT FK_EMP_GRADE FOREIGN KEY (GRADE_CD) REFERENCES ASSIGNMENT3.GRADE(GRADE_CD),
  CONSTRAINT CHK_EMP_NAME CHECK (UPPER(EMP_NAME) = EMP_NAME),
  CONSTRAINT CHK_EMP_BASIC CHECK (BASIC_SAL BETWEEN 5000 AND 9000)
);

CREATE TABLE ASSIGNMENT3.LEAVE_TYPE (
  LEAVE_TYPE_ID INT NOT NULL,
  LEAVE_DESC VARCHAR(50) NOT NULL,
  CONSTRAINT PK_LEAVE_TYPE PRIMARY KEY (LEAVE_TYPE_ID)
);

CREATE TABLE ASSIGNMENT3.EMP_LEAVE_REGISTER (
  EMP_ID INT NOT NULL,
  LEAVE_FROM_DATE DATE NOT NULL,
  LEAVE_TO_DATE DATE NOT NULL,
  LEAVE_TYPE_ID INT NOT NULL,
  CONSTRAINT PK_EMP_LEAVE_REGISTER PRIMARY KEY (EMP_ID, LEAVE_FROM_DATE),
  CONSTRAINT UK_EMP_LEAVE_REGISTER UNIQUE (EMP_ID, LEAVE_TO_DATE),
  CONSTRAINT FK_EMP_LEAVE_REG_EMP FOREIGN KEY (EMP_ID) REFERENCES ASSIGNMENT3.EMPLOYEE(EMP_ID) ON DELETE CASCADE
);
